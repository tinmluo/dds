angular.module("youtube-embed",["ng"]).service("$youtube",["$window","$rootScope",function(e,t){function r(e,t){return e.indexOf(t)>-1}function n(e){t.$apply(function(){t.$broadcast(e)})}function i(){n(p+"ready")}function a(e){var t=l[e.data];"undefined"!=typeof t&&n(p+t),u.currentState=t}var o=/https?:\/\/(?:[0-9A-Z-]+\.)?(?:youtu\.be\/|youtube(?:-nocookie)?\.com\S*[^\w\s-])([\w-]{11})(?=[^\w-]|$)(?![?=&+%\w.-]*(?:['"][^<>]*>|<\/a>))[?=&+%\w.-]*/gi,d=/t=(\d+)[ms]?(\d+)?s?/,u={ready:!1,playerId:null,player:null,videoId:null,playerHeight:null,playerWidth:null,currentState:null,setURL:function(e){u.videoId=u.getIdFromURL(e)},getIdFromURL:function(e){var t=e.replace(o,"$1");if(r(t,";")){var n=t.split(";");if(r(n[1],"%")){var i=decodeURIComponent(t.split(";")[1]);t=("http://youtube.com"+i).replace(o,"$1")}else t=n[0]}else r(t,"#")&&(t=t.split("#")[0]);return t},getTimeFromURL:function(e){e||(e="");var t=e.match(d);if(!t)return 0;var n=t[0],i=t[1],a=t[2];return"undefined"!=typeof a?(a=parseInt(a,10),i=parseInt(i,10)):r(n,"m")?(i=parseInt(i,10),a=0):(a=parseInt(i,10),i=0),a+60*i},createPlayer:function(e){return new YT.Player(this.playerId,{height:this.playerHeight,width:this.playerWidth,videoId:this.videoId,playerVars:e,events:{onReady:i,onStateChange:a}})},loadPlayer:function(e){this.ready&&this.playerId&&this.videoId&&(this.player&&"function"==typeof this.player.destroy&&this.player.destroy(),this.player=this.createPlayer(e))}},l={0:"ended",1:"playing",2:"paused",3:"buffering",5:"queued"},p="youtube.player.";return function(){var e=["http:","https:"],t="//www.youtube.com/iframe_api";e.indexOf(window.location.protocol)<0&&(t="http:"+t);var r=document.createElement("script");r.src=t;var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(r,n)}(),e.onYouTubeIframeAPIReady=function(){t.$apply(function(){u.ready=!0})},u}]).directive("youtubeVideo",["$youtube",function(e){return{restrict:"EA",scope:{videoId:"=",videoUrl:"=",playerVars:"=",playerHeight:"=",playerWidth:"="},link:function(t,r){e.playerId=r[0].id,e.playerHeight=t.playerHeight||390,e.playerWidth=t.playerWidth||640;var n=t.$watch(function(){return e.ready&&("undefined"!=typeof t.videoUrl||"undefined"!=typeof t.videoId)},function(r){r&&(n(),"undefined"!=typeof t.videoUrl?t.$watch("videoUrl",function(r){e.setURL(r),e.loadPlayer(t.playerVars)}):t.$watch("videoId",function(r){e.videoId=r,e.loadPlayer(t.playerVars)}))})}}}]);