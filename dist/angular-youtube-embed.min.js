angular.module("youtube-embed",["ng"]).service("youtubeEmbedUtils",["$window","$rootScope",function(e,t){function r(e,t){return e.indexOf(t)>-1}var o={},n=/https?:\/\/(?:[0-9A-Z-]+\.)?(?:youtu\.be\/|youtube(?:-nocookie)?\.com\S*[^\w\s-])([\w-]{11})(?=[^\w-]|$)(?![?=&+%\w.-]*(?:['"][^<>]*>|<\/a>))[?=&+%\w.-]*/gi,i=/t=(\d+)[ms]?(\d+)?s?/;return o.getIdFromURL=function(e){var t=e.replace(n,"$1");if(r(t,";")){var o=t.split(";");if(r(o[1],"%")){var i=decodeURIComponent(t.split(";")[1]);t=("http://youtube.com"+i).replace(n,"$1")}else t=o[0]}else r(t,"#")&&(t=t.split("#")[0]);return t},o.getTimeFromURL=function(e){e=e||"";var t=e.match(i);if(!t)return 0;var o=t[0],n=t[1],a=t[2];return"undefined"!=typeof a?(a=parseInt(a,10),n=parseInt(n,10)):r(o,"m")?(n=parseInt(n,10),a=0):(a=parseInt(n,10),n=0),a+60*n},console.log("WTF",o.getTimeFromURL),function(){var e=document.createElement("script");e.src="//www.youtube.com/iframe_api";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}(),console.log("WTF1",o.getTimeFromURL),o.ready=!1,console.log("WTF2",o.getTimeFromURL),e.onYouTubeIframeAPIReady=function(){t.$apply(function(){o.ready=!0})},console.log("WTF3",o.getTimeFromURL),o}]).directive("youtubeVideo",["youtubeEmbedUtils",function(e){console.log("INJECTED UTILS",e.getTimeFromURL);var t=1,r={"-1":"unstarted",0:"ended",1:"playing",2:"paused",3:"buffering",5:"queued"},o="youtube.player.";return{restrict:"EA",scope:{videoId:"=?",videoUrl:"=?",player:"=?",playerVars:"=?",playerHeight:"=?",playerWidth:"=?"},link:function(n,i,a){function u(){var e=Array.prototype.slice.call(arguments);n.$apply(function(){n.$emit.apply(n,e)})}function d(e){var t=r[e.data];"undefined"!=typeof t&&u(o+t,n.player,e),n.player.currentState=t}function l(e){n.start,u(o+"ready",n.player,e)}function p(){var e=new YT.Player(c,{height:n.playerHeight,width:n.playerWidth,videoId:n.videoId,playerVars:n.playerVars,events:{onReady:l,onStateChange:d}});return e.id=c,e}function y(){c&&n.videoId&&(n.player&&"function"==typeof n.player.destroy&&n.player.destroy(),n.player=p())}n.utils=e;var c=a.playerId||i[0].id||"unique-youtube-embed-id-"+t++;i[0].id=c,n.playerHeight=n.playerHeight||390,n.playerWidth=n.playerWidth||640,n.playerVars||(n.playerVars={}),n.$watch("utils.getTimeFromURL",function(e){console.log("TIME FROM OURL",e)});var s=n.$watch(function(){return n.utils.ready&&("undefined"!=typeof n.videoUrl||"undefined"!=typeof n.videoId)},function(e){e&&(s(),"undefined"!=typeof n.videoUrl?n.$watch("videoUrl",function(e){n.videoId=n.utils.getIdFromURL(e),console.log("GET TIME",e,n.utils.getTimeFromURL);var t=n.utils.getTimeFromURL(e);n.playerVars.start=n.playerVars.start||t,y()}):n.$watch("videoId",function(e){n.videoId=e,y()}))})}}}]);