angular.module("youtube-embed",["ng"]).service("$youtube",["$window","$rootScope",function(e,t){function r(e,t){return e.indexOf(t)>-1}function n(e){t.$apply(function(){t.$broadcast(e)})}function a(){n(y+"ready")}function i(e){var t=l[e.data];"undefined"!=typeof t&&n(y+t),u.currentState=t}var o=/https?:\/\/(?:[0-9A-Z-]+\.)?(?:youtu\.be\/|youtube(?:-nocookie)?\.com\S*[^\w\s-])([\w-]{11})(?=[^\w-]|$)(?![?=&+%\w.-]*(?:['"][^<>]*>|<\/a>))[?=&+%\w.-]*/gi,d=/t=(\d+)[ms]?(\d+)?s?/,u={ready:!1,playerId:null,player:null,videoId:null,playerHeight:null,playerWidth:null,currentState:null,setURL:function(e){u.videoId=u.getIdFromURL(e)},getIdFromURL:function(e){var t=e.replace(o,"$1");if(r(t,";")){var n=t.split(";");if(r(n[1],"%")){var a=decodeURIComponent(t.split(";")[1]);t=("http://youtube.com"+a).replace(o,"$1")}else t=n[0]}else r(t,"#")&&(t=t.split("#")[0]);return t},getTimeFromURL:function(e){e||(e="");var t=e.match(d);if(!t)return 0;var n=t[0],a=t[1],i=t[2];return"undefined"!=typeof i?(i=parseInt(i,10),a=parseInt(a,10)):r(n,"m")?(a=parseInt(a,10),i=0):(i=parseInt(a,10),a=0),i+60*a},createPlayer:function(e){return new YT.Player(this.playerId,{height:this.playerHeight,width:this.playerWidth,videoId:this.videoId,playerVars:e,events:{onReady:a,onStateChange:i}})},loadPlayer:function(e){this.ready&&this.playerId&&this.videoId&&(this.player&&"function"==typeof this.player.destroy&&this.player.destroy(),this.player=this.createPlayer(e))}},l={0:"ended",1:"playing",2:"paused",3:"buffering",5:"queued"},y="youtube.player.";return function(){var e=document.createElement("script");e.src="//www.youtube.com/iframe_api";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}(),e.onYouTubeIframeAPIReady=function(){t.$apply(function(){u.ready=!0})},u}]).directive("youtubeVideo",["$youtube",function(e){return{restrict:"EA",scope:{videoId:"=",videoUrl:"=",playerVars:"=",playerHeight:"=",playerWidth:"="},link:function(t,r){e.playerId=r[0].id,e.playerHeight=t.playerHeight||390,e.playerWidth=t.playerWidth||640;var n=t.$watch(function(){return e.ready&&("undefined"!=typeof t.videoUrl||"undefined"!=typeof t.videoId)},function(r){r&&(n(),"undefined"!=typeof t.videoUrl?t.$watch("videoUrl",function(r){e.setURL(r),e.loadPlayer(t.playerVars)}):t.$watch("videoId",function(r){e.videoId=r,e.loadPlayer(t.playerVars)}))})}}}]);